<md-content layout-fill ng-init="$ctrl.refreshCards()">
  <md-toolbar class="md-table-toolbar md-default">
    <div class="md-toolbar-tools">
      <div class="md-title">スクフェス　特技期待値ランキング</div>
    </div>
  </md-toolbar>

  <md-card>
    <md-card-header>
      <md-card-header-text>
        <span class='md-title'>曲情報</span>
      </md-card-header-text>
    </md-card-header>

    <md-card-content>
      <!-- TODO: enable the followings.>
      <md-input-container>
        <label>グループ</label>
        <md-select ng-model="$ctrl.music.group">
          <md-option ng-value="'μ\'s'">μ's</md-option>
          <md-option ng-value="'Aqours'">Aqours</md-option>
        </md-select>
      </md-input-container>
      <md-input-container>
        <label>属性</label>
        <md-select ng-model="$ctrl.music.type">
          <md-option ng-value="'smile'">スマイル</md-option>
          <md-option ng-value="'pure'">ピュア</md-option>
          <md-option ng-value="'cool'">クール</md-option>
        </md-select>
      </md-input-container>
      <md-input-container>
        <label>フレCS</label>
        <md-select ng-model="$ctrl.bonus.LS_pre">
          <md-option ng-value="'smile'">スマイル</md-option>
          <md-option ng-value="'pure'">ピュア</md-option>
          <md-option ng-value="'cool'">クール</md-option>
          <md-option ng-value="null">なし</md-option>
        </md-select>
      </md-input-container>
      <md-input-container ng-show="$ctrl.bonus.LS_pre !== null">
        <label>フレCS (続き)</label>
        <md-select ng-model="$ctrl.bonus.LS_suf">
          <md-option ng-value="'smile'">プリンセス</md-option>
          <md-option ng-value="'pure'">エンジェル</md-option>
          <md-option ng-value="'cool'">エンプレス</md-option>
        </md-select>
      </md-input-container>
      <md-input-container ng-show="$ctrl.bonus.LS_pre !== null">
        <label>フレCS (サブ)</label>
        <md-select ng-model="$ctrl.bonus.LS_sub">
          <md-option ng-value="null">なし</md-option>
          <md-option ng-value="'μ\'s'">μ's</md-option>
          <md-option ng-value="'Aqours'">Aqours</md-option>
          <md-option ng-value="'first-year'">1年生</md-option>
          <md-option ng-value="'second-year'">2年生</md-option>
          <md-option ng-value="'third-year'">3年生</md-option>
          <md-option ng-value="'Printemps'">Printemps</md-option>
          <md-option ng-value="'lily white'">lily white</md-option>
          <md-option ng-value="'BiBi'">BiBi</md-option>
          <md-option ng-value="'CYaRon！'">CYaRon！</md-option>
          <md-option ng-value="'AZALEA'">AZALEA</md-option>
          <md-option ng-value="'Guilty Kiss'">Guilty Kiss</md-option>
        </md-select>
      </md-input-container>
      <-->
      <form name="musicForm">
        <md-input-container>
          <label>ノーツ数</label>
          <input required name='notesInput' type='number' step=1 ng-model='$ctrl.music.notes' ng-min="1" ng-max="2000">
          <div ng-messages="musicForm.notesInput.$error">
            <div ng-message="required">ノーツ数を入力してください</div>
            <div ng-message="min">ノーツ数が少なすぎます</div>
            <div ng-message="max">ノーツ数が多すぎます</div>
          </div>
        </md-input-container>
        <md-input-container>
          <label>時間</label>
          <input required name='timeInput' type='number' step=1 ng-model='$ctrl.music.time' ng-min="1" ng-max="500">
          <div ng-messages="musicForm.timeInput.$error">
            <div ng-message="required">時間を入力してください</div>
            <div ng-message="min">時間が短すぎます</div>
            <div ng-message="max">時間が長すぎます</div>
          </div>
        </md-input-container>
        <md-input-container>
          <label>パーフェクト率</label>
          <input required name='perfectInput' type='number' step=1 ng-model='$ctrl.music.perfect' ng-min="0" ng-max="100">
          <div ng-messages="musicForm.perfectInput.$error">
            <div ng-message="required">パーフェクト率を入力してください</div>
            <div ng-message="min">パーフェクト率が小さすぎます</div>
            <div ng-message="max">パーフェクト率が大きすぎます</div>
          </div>
        </md-input-container>
      </form>
      <!-- TODO: enable the followings.>
      <form name="bonusForm">
        <md-input-container>
          <label>タップスコアアレンジ</label>
          <input required name='tapBonusInput' type='number' step=0.01 ng-model='$ctrl.bonus.arbitrary_tap' ng-min="1.0" ng-max="1.5">
          <div ng-messages="bonusForm.tapBonusInput.$error">
            <div ng-message="required">タップスコア倍率を入力してください</div>
            <div ng-message="min">タップスコア倍率が小さすぎます</div>
            <div ng-message="max">タップスコア倍率が大きすぎます</div>
          </div>
        </md-input-container>
        <md-input-container>
          <label>特技発動率アレンジ</label>
          <input required name='skillBonusInput' type='number' step=0.01 ng-model='$ctrl.bonus.arbitrary_skill' ng-min="1.0" ng-max="1.5">
          <div ng-messages="bonusForm.skillBonusInput.$error">
            <div ng-message="required">特技発動率倍率を入力してください</div>
            <div ng-message="min">特技発動率倍率が小さすぎます</div>
            <div ng-message="max">特技発動率倍率が大きすぎます</div>
          </div>
        </md-input-container>
      </form>
      <-->
    </md-card-content>
  </md-card>

<md-toolbar class="md-table-toolbar md-default">
  <div class="md-toolbar-tools">
    <span>ランキング</span>
  </div>
</md-toolbar>

<div layout-padding layout="row">
  <div layout-align="center center">
    <span>特技種別: </span>
    <md-input-container>
      <md-select ng-model="$ctrl.filtering_condition.skill_type" placeholder="Select a skill type.">
        <md-option ng-value="skill_type" ng-repeat="skill_type in $ctrl.available_skill_type">{{skill_type}}</md-option>
      </md-select>
    </md-input-container>
  </div>

  <div layout-align="center center">
    <span>特技レベル: </span>
    <md-input-container>
      <md-select ng-model="$ctrl.skill_level" placeholder="Select a skill level.">
        <md-option ng-value="skill_level" ng-repeat="skill_level in $ctrl.level_range">{{skill_level + 1}}</md-option>
      </md-select>
    </md-input-container>
  </div>

  <md-menubar>
    <md-menu layout-align="center center">
      <md-button class="md-accent md-raised" md-ripple-size="fill" ng-click="$mdOpenMenu()">
        <b>フィルタ</b>
      </md-button>
      <md-menu-content layout-align="center center" layout="column">
        <b>属性</b>
        <div layout-padding layout="row">
          <div ng-repeat="type in $ctrl.card_data.types" flex="33" ng-click="$ctrl.setTypeCondition($event, type)" md-prevent-menu-close="md-prevent-menu-close">
            <img ng-if="$ctrl.hasTypeCondition(type)" ng-src="https://darsein.github.io/lovelive/sif/tools/score_calculation/img/filters/type_{{type}}_gray.png" width="50dp"/>
            <img ng-if="!$ctrl.hasTypeCondition(type)" ng-src="https://darsein.github.io/lovelive/sif/tools/score_calculation/img/filters/type_{{type}}.png" width="50dp"/>
          </div>
        </div>
    　  <md-divider></md-divider>
        <b>レアリティ</b>
        <div layout="row">
          <div ng-repeat="rarity in $ctrl.card_data.rarities" flex="20" ng-click="$ctrl.setRarityCondition($event, rarity)" md-prevent-menu-close="md-prevent-menu-close">
            <img ng-if="$ctrl.hasRarityCondition(rarity)" ng-src="https://darsein.github.io/lovelive/sif/tools/score_calculation/img/filters/rarity_{{rarity}}_gray.png" width="50dp" />
            <img ng-if="!$ctrl.hasRarityCondition(rarity)" ng-src="https://darsein.github.io/lovelive/sif/tools/score_calculation/img/filters/rarity_{{rarity}}.png" width="50dp" />
          </div>
        </div>
      </md-menu-content>
    </md-menu>
  </md-menubar>
</div>

<!-- exact table from live demo -->
<md-table-container>
  <table md-table multiple ng-model="$ctrl.cards" md-progress="$ctrl.promise">
    <thead md-head md-order="$ctrl.query.order"  md-on-reorder="$ctrl.refreshCards">
      <tr md-row>
        <th md-column md-order-by="id"><span>ID</span></th>
        <th md-column><span>アイコン</span></th>
        <th md-column md-order-by="name"><span>カード名</span></th>
        <th md-column md-numeric md-order-by="skill_exp[{{$ctrl.skill_level}}]"><span>Lv{{$ctrl.skill_level+1}}時期待値</span></th>
      </tr>
    </thead>
    <tbody md-body>
      <tr md-row
          md-select="card"
          ng-repeat="card in $ctrl.cards
                       | orderBy: $ctrl.query.order
                       | limitTo: $ctrl.query.limit : ($ctrl.query.page -1) * $ctrl.query.limit"">
        <td md-cell>{{card.id}}</td>
        <td md-cell>
          <img ng-src="https://darsein.github.io/lovelive/sif/tools/score_calculation/img/faces/{{card.id}}.png" width="48dp"/></td>
        <td md-cell>{{card.name}}</td>
        <td md-cell>{{card.skill_exp[$ctrl.skill_level] | number : 2}}</td>
      </tr>
    </tbody>
  </table>
</md-table-container>

<md-table-pagination
  md-limit="$ctrl.query.limit"
  md-limit-options="$ctrl.query.limit_options"
  md-page="$ctrl.query.page"
  md-total="{{$ctrl.cards.length}}"
  md-on-paginate="$ctrl.refreshCards"
  md-page-select md-boundary-links></md-table-pagination>
</md-content>
